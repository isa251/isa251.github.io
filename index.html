<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>いざべらのポートフォリオ</title>

  <style>
    .ytWrap{
      margin-top: 12px;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
    }
    .ytWrap iframe{
      width: 100%;
      aspect-ratio: 16 / 9;
      border: 0;
      display:block;
    }

    :root{
      --bg:#cfdde8;

      --paper:#fbf7ef;
      --paper2:#f3eddc;
      --ink:#101827;
      --rule: rgba(16,24,39,.12);

      --coverA:#fbf7ef;
      --coverB:#fbf7ef;
      --coverText:#34373a;

      --r: 18px;
      --serif: ui-serif, "Times New Roman", "Noto Serif JP", serif;
      --sans: ui-sans-serif, system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Segoe UI", sans-serif;

      --bookW: min(80vw, 1400px);
      --bookH: min(80vh, 900px);

      --a4H: min(78vh, 820px);
      --a4W: min(calc(var(--a4H) / 1.414), 92vw);

      --coverShift: -120px;

      --flipDur: 600ms;
      --coverDur: 480ms;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      display:grid;
      place-items:center;
      font-family: var(--sans);
      background: var(--bg);
      overflow:hidden;
    }

    .desk{
      width: 100vw;
      height: 100vh;
      display:grid;
      place-items:center;
      perspective: 2200px;
      padding:
        max(16px, env(safe-area-inset-top))
        max(16px, env(safe-area-inset-right))
        max(16px, env(safe-area-inset-bottom))
        max(16px, env(safe-area-inset-left));
    }

    .bookRig{
      position:relative;
      width: var(--bookW);
      height: var(--bookH);
      transform-style: preserve-3d;
    }

    .bookRig::before{
      content:"";
      position:absolute;
      left:50%;
      bottom:-34px;
      width: 94%;
      height: 44px;
      transform: translateX(-50%);
      background: radial-gradient(closest-side, rgba(0,0,0,.35), transparent 72%);
      filter: blur(10px);
      opacity:.95;
      pointer-events:none;
      z-index:0;
    }

    .coverStage{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      z-index: 10;
      opacity:1;
      visibility:visible;
      transition: opacity .12s ease, visibility 0s linear;
      padding: clamp(14px, 4vw, 28px);
    }
    .bookRig.opened .coverStage{
      opacity:0;
      visibility:hidden;
      transition: opacity .12s ease, visibility 0s linear .12s;
      pointer-events:none;
    }

    .a4Wrap{
      width: var(--a4W);
      height: var(--a4H);
      max-width: 100%;
      max-height: 100%;
      position:relative;
      transform-style: preserve-3d;
      transform: translateX(0);
      transition: transform .35s cubic-bezier(.2,.8,.2,1);
      margin: 0 auto;
    }
    .bookRig.opening .a4Wrap{
      transform: translateX(var(--coverShift));
    }

    .coverCard{
      position:absolute;
      inset:0;
      border-radius: var(--r);
      transform-style: preserve-3d;
      transform-origin: left center;
      transition: transform var(--coverDur) cubic-bezier(.2,.75,.2,1);
      border: 1px solid rgba(0,0,0,.08);
      overflow:hidden;
      background: linear-gradient(135deg, var(--coverA), var(--coverB));
      box-shadow:
        0 26px 70px rgba(0,0,0,.22),
        0 10px 22px rgba(0,0,0,.14);
    }
    .bookRig.opening .coverCard{ transform: rotateY(-155deg); }

    .magTitle{
      position:absolute;
      top: 18px;
      left: 20px;
      right: 20px;
      font-family: var(--serif);
      font-weight: 800;
      font-size: clamp(40px, 5vw, 64px);
      letter-spacing: .08em;
      text-transform: uppercase;
      color: var(--coverText);
      line-height: 1;
      text-shadow: 0 10px 30px rgba(0,0,0,.10);
    }
    .magRow{
      position:absolute;
      top: 110px;
      left: 22px;
      right: 22px;
      display:flex;
      justify-content:space-between;
      font-family: var(--serif);
      font-size: clamp(28px, 4.2vw, 54px);
      letter-spacing:.14em;
      text-transform: uppercase;
      color: var(--coverText);
      font-weight: 800;
      opacity: .95;
    }

    .openCorner{
      position:absolute;
      right:0; bottom:0;
      width: 30%;
      height: 34%;
      cursor:pointer;
      border-top-left-radius: 30px;
      background: transparent;
    }
    .openCorner::after{
      content:"";
      position:absolute;
      right: 0; bottom: 0;
      width: 78px; height: 78px;
      clip-path: polygon(100% 0, 0 100%, 100% 100%);
      background: linear-gradient(135deg, rgba(0,0,0,.08), rgba(0,0,0,0));
      filter: drop-shadow(0 8px 12px rgba(0,0,0,.18));
      opacity:.95;
      pointer-events:none;
    }

    .spreadStage{
      position:absolute;
      inset:0;
      display:grid;
      place-items:center;
      opacity:0;
      visibility:hidden;
      pointer-events:none;
      transition: opacity .12s ease, visibility 0s linear .12s;
      z-index: 2;
      padding: 10px;
    }
    .bookRig.opened .spreadStage{
      opacity:1;
      visibility:visible;
      pointer-events:auto;
      transition: opacity .12s ease, visibility 0s linear;
    }

    .spreadWrap{
      width: 100%;
      height: 100%;
      position:relative;
      z-index:1;
      filter: drop-shadow(0 22px 44px rgba(0,0,0,.22));
    }

    .spine{
      position:absolute;
      left:50%;
      top:0;
      width:10px;
      height:100%;
      transform: translateX(-50%);
      background: rgba(0,0,0,.18);
      border-radius: 10px;
      opacity:.92;
      z-index: 6;
      pointer-events:none;
    }

    .spread{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-columns: 1fr 1fr;
      border-radius: var(--r);
      overflow:hidden;
      background: var(--paper);
      box-shadow:
        0 0 0 1px rgba(0,0,0,.06) inset,
        0 12px 28px rgba(0,0,0,.12);
    }
    .spread.under{ z-index: 2; }
    .spread.current{ z-index: 4; }

    .page{
      position:relative;
      padding: clamp(18px, 2.2vw, 34px);
      color: var(--ink);
      overflow:hidden;
      background: var(--paper);
      font-family: var(--sans);
    }
    .page.left{
      background: linear-gradient(90deg, var(--paper2), var(--paper));
      box-shadow: inset -18px 0 30px rgba(0,0,0,.08);
    }
    .page.right{
      box-shadow: inset 18px 0 30px rgba(0,0,0,.08);
    }

    .kicker{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:14px;
      color: rgba(17,24,39,.56);
      letter-spacing:.02em;
    }
    .rule{ height:1px; background: var(--rule); margin: 12px 0; }
    .page h3{
      margin:0;
      font-family: var(--serif);
      font-weight: 800;
      font-size: clamp(18px, 2.2vw, 28px);
      letter-spacing:.01em;
      line-height:1.2;
    }
  .page p{
  margin:0;
  line-height:1.92;
  font-size: clamp(16px, 1.35vw, 19px);
  color: rgba(17,24,39,.80);
}


    .workShot{
      margin-top: 12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .workShot img{
      width: 100%;
      height: auto;
      display:block;
      border-radius: 14px;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
    }
    .workCaption{
      font-size: 14px;
      color: rgba(16,24,39,.60);
    }

    .mediaWrap{
      width: 100%;
      height: 100%;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
    }
    .mediaWrap video,
    .mediaWrap img{
      width: 100%;
      height: 100%;
      display: block;
      object-fit: cover;
    }
    .mediaWrap img{
      display:none;
      opacity: 0;
      transition: opacity 600ms ease;
    }

    .page.mediaMode{
      padding: 0;
      overflow: visible;
    }
    .page.mediaMode::after,
    .page.mediaMode::before{ display:none; content:none; }

    .spreadMedia{
      position:absolute;
      inset:0;
      width:100%;
      left:0;
      height:100%;
      border-radius: 14px;
      overflow:hidden;
      z-index: 6;
      box-shadow: 0 14px 30px rgba(0,0,0,.12);
      background: rgba(0,0,0,.06);
    }
    .spreadMedia video{
      position:relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      display:block;
      object-fit: cover;
    }

    .whiteFade{
      position:absolute;
      inset:0;
      background:#fff;
      opacity:0;
      transition: opacity 1000ms ease;
      pointer-events:none;
      z-index: 7;
    }
    .spreadMedia.show-white .whiteFade{ opacity:1; }
    .spreadMedia.white-out .whiteFade{
      opacity:0;
      transition-duration: 300ms;
    }

    .newYearSplit{
      position:absolute;
      inset:0;
      display:grid;
      grid-template-columns: 1fr 1fr;
      z-index: 6;
      pointer-events:none;
    }
    .newYearLeft{
      position:relative;
      display:grid;
      place-items:center;
      overflow:hidden;
      width:100%;
      height:100%;
    }
    .newYearRight{
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      width:100%;
      height:100%;
    }
    .newYearImage{
      object-fit: cover;
      opacity:0;
      transition: opacity 600ms ease;
    }
    .newYearImage.left{
      width: min(1024px, 90%);
      height: min(1024px, 90%);
      transform: translateX(40%);
      transition: opacity 600ms ease, transform 1000ms ease;
    }
    .newYearImage.right{
      width: clamp(260px, 40vw, 520px);
      height: clamp(260px, 40vw, 520px);
      max-width: 100%;
      max-height: 100%;
      flex: 0 1 60%;
    }
    .spreadMedia.show-image .newYearImage{ opacity:1; }
    .spreadMedia.image-shift .newYearImage.left{ transform: translateX(0); }

    .newYearTextGroup{
      display:flex;
      align-items:center;
      justify-content:center;
      gap: clamp(12px, 2vw, 24px);
      width:100%;
      max-width: 90%;
    }
    .newYearText{
      writing-mode: vertical-rl;
      text-orientation: upright;
      -webkit-writing-mode: vertical-rl;
      -webkit-text-orientation: upright;
      font-family: var(--serif);
      font-weight: 800;
      font-size: clamp(28px, 3.2vw, 54px);
      letter-spacing: .18em;
      color: #b30018;
      z-index: 4;
    }
    .newYearText span{
      opacity:0;
      animation: charIn 0.4s ease forwards;
      animation-delay: var(--d);
    }
    .spreadMedia:not(.show-text) .newYearText span{
      animation: none;
      opacity:0;
    }

    @keyframes charIn{
      from{ opacity:0; }
      to{ opacity:1; }
    }

    .spreadWrap.mediaSpread .spine{ display:none; }
    .mediaOverlay{
      position:absolute;
      inset:0;
      z-index: 6;
      pointer-events:none;
      opacity:1;
      transition: opacity 200ms ease;
    }
    .mediaOverlay.pending{ opacity:0; }

    .fireworksLayer{
      position:absolute;
      inset:0;
      z-index: 5;
      pointer-events:none;
    }
    .firework{
      position:absolute;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background:
        radial-gradient(circle, rgba(255,255,255,.9) 0 3px, transparent 4px),
        radial-gradient(circle, rgba(255,120,120,.9) 0 3px, transparent 4px),
        radial-gradient(circle, rgba(255,210,120,.9) 0 3px, transparent 4px),
        radial-gradient(circle, rgba(120,200,255,.9) 0 3px, transparent 4px),
        radial-gradient(circle, rgba(255,120,200,.9) 0 3px, transparent 4px);
      filter: drop-shadow(0 0 6px rgba(255,255,255,.65));
      opacity:0;
      transform: scale(0.2);
      animation: burst 3.6s ease-in-out infinite;
    }
    .firework.fw1{ top: 10%; left: 12%; animation-delay: 0s; }
    .firework.fw2{ top: 8%; right: 12%; animation-delay: 1.2s; }
    .firework.fw3{ bottom: 14%; left: 24%; animation-delay: .6s; }
    .firework.fw4{ bottom: 16%; right: 20%; animation-delay: 1.8s; }
    .firework.fw5{ top: 40%; left: 50%; animation-delay: 2.4s; }

    @keyframes burst{
      0%{ opacity:0; transform: scale(0.2); }
      20%{ opacity:.7; }
      50%{ opacity:.45; transform: scale(1); }
      80%{ opacity:.2; }
      100%{ opacity:0; transform: scale(1.2); }
    }

    .page.right::after{
      content:"";
      position:absolute;
      right: 0;
      bottom: 0;
      width: 74px;
      height: 74px;
      clip-path: polygon(100% 0, 0 100%, 100% 100%);
      background: linear-gradient(135deg, rgba(16,24,39,.16), rgba(16,24,39,0));
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.14));
      opacity:.9;
      pointer-events:none;
    }
    .page.right .flipMark{
      position:absolute;
      right: 16px;
      bottom: 12px;
      font-size: 14px;
      color: rgba(16,24,39,.60);
      user-select:none;
      pointer-events:none;
    }

    .page.left::before{
      content:"";
      position:absolute;
      left: 0;
      bottom: 0;
      width: 74px;
      height: 74px;
      clip-path: polygon(0 0, 0 100%, 100% 100%);
      background: linear-gradient(225deg, rgba(16,24,39,.14), rgba(16,24,39,0));
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
      opacity:.85;
      pointer-events:none;
    }
    .page.left .backMark{
      position:absolute;
      left: 16px;
      bottom: 12px;
      font-size: 14px;
      color: rgba(16,24,39,.58);
      user-select:none;
      pointer-events:none;
    }

    .flipNext{
      position:absolute;
      top:0;
      left:50%;
      width:50%;
      height:100%;
      transform-style: preserve-3d;
      transform-origin: left center;
      pointer-events:none;
      z-index: 9;
      display:none;
      transition: transform var(--flipDur) cubic-bezier(.2,.75,.2,1);
      will-change: transform;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
    }
    .flipNext.active{ display:block; }
    .flipFace{ position:absolute; inset:0; backface-visibility:hidden; }
    .flipBack{ transform: rotateY(180deg); }

    .shadowNext{
      position:absolute;
      top:0; left:50%;
      width:50%; height:100%;
      z-index: 8;
      pointer-events:none;
      opacity:0;
      transition: opacity .08s ease;
      background: radial-gradient(120% 90% at 0% 50%, rgba(0,0,0,.22), transparent 70%);
    }
    .shadowNext.on{ opacity:1; }

    .flipPrev{
      position:absolute;
      top:0;
      left:0;
      width:50%;
      height:100%;
      transform-style: preserve-3d;
      transform-origin: right center;
      pointer-events:none;
      z-index: 9;
      display:none;
      transition: transform var(--flipDur) cubic-bezier(.2,.75,.2,1);
      will-change: transform;
      box-shadow: 0 18px 40px rgba(0,0,0,.18);
    }
    .flipPrev.active{ display:block; }
    .prevFace{ position:absolute; inset:0; backface-visibility:hidden; }
    .prevBack{ transform: rotateY(180deg); }

    .shadowPrev{
      position:absolute;
      top:0; left:0;
      width:50%; height:100%;
      z-index: 8;
      pointer-events:none;
      opacity:0;
      transition: opacity .08s ease;
      background: radial-gradient(120% 90% at 100% 50%, rgba(0,0,0,.22), transparent 70%);
    }
    .shadowPrev.on{ opacity:1; }

    .hotRight{
      position:absolute; right:0; bottom:0;
      width: 26%; height: 34%;
      z-index: 20;
      cursor:pointer;
      border-top-left-radius: 30px;
      background: transparent;
    }
    .hotLeft{
      position:absolute; left:0; bottom:0;
      width: 26%; height: 34%;
      z-index: 20;
      cursor:pointer;
      border-top-right-radius: 30px;
      background: transparent;
    }

    @media (max-width: 760px){
      body{ overflow:auto; }
      .desk{ overflow: visible; }

      :root{
        --bookW: 94vw;
        --bookH: 86vh;
        --coverShift: -70px;
        --a4H: min(78vh, 720px);
        --a4W: min(calc(var(--a4H) / 1.414), 92vw);
      }

      .spine{ display:none; }
      .spread{ grid-template-columns: 1fr; }
      .spread .page.left{ display:none; }
      .spread .page.right{ grid-column: 1 / -1; }

      .flipNext{ left:0; width:100%; }
      .shadowNext{ left:0; width:100%; background: radial-gradient(120% 90% at 0% 50%, rgba(0,0,0,.18), transparent 70%); }

      .flipPrev{ width:100%; }
      .shadowPrev{ width:100%; background: radial-gradient(120% 90% at 100% 50%, rgba(0,0,0,.18), transparent 70%); }

      .hotRight,.hotLeft{ width: 40%; height: 30%; }

      .spreadWrap[data-can-prev="true"] .page.right::before{
        content:"";
        position:absolute;
        left: 0;
        bottom: 0;
        width: 74px;
        height: 74px;
        clip-path: polygon(0 0, 0 100%, 100% 100%);
        background: linear-gradient(225deg, rgba(16,24,39,.14), rgba(16,24,39,0));
        filter: drop-shadow(0 10px 14px rgba(0,0,0,.12));
        opacity:.85;
        pointer-events:none;
      }

      .newYearImage{
        width: min(720px, 84%);
        height: min(720px, 84%);
      }
      .newYearImage.right{
        width: min(70%, 360px);
        height: min(70%, 360px);
        max-width: 70%;
      }
      .newYearText{
        font-size: clamp(22px, 6vw, 40px);
      }
    }
  </style>
</head>

<body>
  <div class="desk">
    <div class="bookRig" id="bookRig">

      <div class="coverStage">
        <div class="a4Wrap">
          <div class="coverCard">
            <div class="magTitle">Isabella</div>
            <div class="magRow"><span>Portfolio</span></div>
            <div class="openCorner" id="openCorner" title="open"></div>
          </div>
        </div>
      </div>

      <div class="spreadStage">
        <div class="spreadWrap" id="spreadWrap">
          <div class="spine"></div>
          <div class="mediaOverlay" id="mediaOverlay"></div>

          <div class="spread under">
            <section class="page left"  id="uLeft"></section>
            <section class="page right" id="uRight"></section>
          </div>

          <div class="spread current">
            <section class="page left"  id="cLeft"></section>
            <section class="page right" id="cRight"></section>
          </div>

          <div class="shadowNext" id="shadowNext"></div>
          <div class="flipNext" id="flipNext" aria-hidden="true">
            <section class="page right flipFace" id="nextFront"></section>
            <section class="page left  flipFace flipBack" id="nextBack"></section>
          </div>

          <div class="shadowPrev" id="shadowPrev"></div>
          <div class="flipPrev" id="flipPrev" aria-hidden="true">
            <section class="page left  prevFace" id="prevFront"></section>
            <section class="page right prevFace prevBack" id="prevBack"></section>
          </div>

          <div class="hotRight" id="hotRight" title="next"></div>
          <div class="hotLeft"  id="hotLeft"  title="prev"></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const PAGES = {
      1: { title:"Self Introduction", subtitle:"自己紹介", body:[
        "マカオ出身\n映像制作を学びたくて、日本に留学しました。",
        "最近は生成AIの動画に興味があります"
      ]},
      2: { title:"Hobby", subtitle:"好きなもの", body:[
        "好きなアニメは「ジョジョの奇妙な冒険」です。理由は、ストーリーが何度見ても飽きないほど魅力的だからです。独特な画風と世界観も好きです。尊敬する人はその作者、荒木飛呂彦さん。理由は漫画家なのに、生活リズムが驚くほど整っています。朝5時起床・夜9時就寝という徹底していて、原稿の締め切りも遅れたことがないだそうです。あとはもちろん、発想力と世界観が羨ましいです。",
        " "
      ]},
      3: {
        title:"Works",
        subtitle:"これまでの作品",
        body:[
          "グラフィックデザイン"
        ],
        extraHTML: `
          <div class="workShot">
            <img src="assets/img/birdweek_copy.jpg" alt="作品サンプル" loading="lazy">
            <div class="workCaption"></div>
          </div>
        `
      },
      4: {
        title:"Works",
        subtitle:"　",
        body:[
          "映像",
          {
            html: `
              <div class="ytWrap">
                <iframe
                  src="https://www.youtube-nocookie.com/embed/kbTz0UgWW4M"
                  title="YouTube video player"
                  loading="lazy"
                  referrerpolicy="strict-origin-when-cross-origin"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                  allowfullscreen></iframe>
              </div>
            `
          },
          "Thanks for reading!"
        ]
      },

      5: {
    title:"new year 2026",
    subtitle:"new year 2026",
    layout:"media",
    body:[],
    extraHTML: `
      <div class="spreadMedia" data-media-page="newyear">
        <video muted playsinline preload="auto" autoplay>
          <source src="assets/media/new-year-2026.mp4" type="video/mp4">
        </video>
        <div class="whiteFade" aria-hidden="true"></div>
        <div class="fireworksLayer" aria-hidden="true">
          <div class="firework fw1"></div>
          <div class="firework fw2"></div>
          <div class="firework fw3"></div>
          <div class="firework fw4"></div>
          <div class="firework fw5"></div>
        </div>
        <div class="newYearSplit">
          <div class="newYearLeft">
            <img class="newYearImage left" src="assets/media/new-year-2026.png" alt="New year 2026">
          </div>
          <div class="newYearRight">
            <div class="newYearTextGroup" aria-label="2026 謹賀新年">
              <img class="newYearImage right" src="assets/media/new-year-2026-right.png" alt="New year 2026 right">
              <div class="newYearText">
                <span style="--d:0s">2</span>
                <span style="--d:.5s">0</span>
                <span style="--d:1s">2</span>
                <span style="--d:1.5s">6</span>
              </div>
              <div class="newYearText">
                <span style="--d:2s">謹</span>
                <span style="--d:2.5s">賀</span>
                <span style="--d:3s">新</span>
                <span style="--d:3.5s">年</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    `
  },

  6: {
    title:"",
    subtitle:"",
    body:[
      ""
    ]
  },

    };

    const ORDER = Object.keys(PAGES).map(Number).sort((a,b)=>a-b);
    const TOTAL = ORDER.length;

    const SPREADS = [];
    for(let i=0;i<ORDER.length;i+=2){
      SPREADS.push([ORDER[i], ORDER[i+1] ?? ORDER[i]]);
    }

    const mql = window.matchMedia("(max-width: 760px)");
    const isMobile = () => mql.matches;

    let mode = "frontCover";
    let cursor = 0;
    let flipping = false;

    const bookRig = document.getElementById("bookRig");
    const openCorner = document.getElementById("openCorner");
    const spreadWrap = document.getElementById("spreadWrap");
    const mediaOverlay = document.getElementById("mediaOverlay");

    const cLeft = document.getElementById("cLeft");
    const cRight= document.getElementById("cRight");
    const uLeft = document.getElementById("uLeft");
    const uRight= document.getElementById("uRight");

    const hotRight = document.getElementById("hotRight");
    const hotLeft  = document.getElementById("hotLeft");

    const flipNext = document.getElementById("flipNext");
    const nextFront= document.getElementById("nextFront");
    const nextBack = document.getElementById("nextBack");
    const shadowNext = document.getElementById("shadowNext");

    const flipPrev = document.getElementById("flipPrev");
    const prevFront= document.getElementById("prevFront");
    const prevBack = document.getElementById("prevBack");
    const shadowPrev = document.getElementById("shadowPrev");

    const getMsVar = (name, fallback) => {
      const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      if(!v) return fallback;
      if(v.endsWith("ms")) return parseFloat(v);
      if(v.endsWith("s")) return parseFloat(v)*1000;
      return fallback;
    };

    let FLIP_DUR = getMsVar("--flipDur", 600);
    let MID_SWAP = Math.floor(FLIP_DUR * 0.35);

    const esc = (s)=> String(s)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#39;");

    function renderBody(items){
      return (items ?? []).map(item => {
        if (item && typeof item === "object" && "html" in item) {
          return item.html; // ★ここはpで包まない
        }
        return `<p>${esc(String(item)).replaceAll("\n","<br>")}</p>`;
      }).join("");
    }

    function pageHTML(idx, {showBackMark=false, showNextMark=false} = {}){
      const p = PAGES[idx];
      if(p.layout === "media"){
        return p.extraHTML ?? "";
      }
      const body = renderBody(p.body);
      const markRight = showNextMark ? `<div class="flipMark">↘</div>` : "";
      const markLeft  = showBackMark ? `<div class="backMark">↙</div>` : "";
      const extra = p.extraHTML ? `<div style="margin-top:12px;">${p.extraHTML}</div>` : "";
      return `
        <div class="kicker"><span>${esc(p.title)}</span><span>${String(idx).padStart(2,"0")}</span></div>
        <div class="rule"></div>
        <h3>${esc(p.subtitle)}</h3>
        <div style="display:flex; flex-direction:column; gap:12px; margin-top:10px;">
          ${body}
        </div>
        ${extra}
        ${markLeft}${markRight}
      `;
    }

    function setPage(el, idx, opts){
      if(!idx){ el.innerHTML = ""; el.classList.remove("mediaMode"); return; }
      const p = PAGES[idx];
      el.classList.toggle("mediaMode", p.layout === "media");
      el.innerHTML = pageHTML(idx, opts);
    }

    function pageHTMLForFlip(idx, opts){
      const p = PAGES[idx];
      if(p?.layout === "media") return "";
      return pageHTML(idx, opts);
    }

    function updateMobileCues(){
      if(isMobile()){
        spreadWrap.dataset.canPrev = String(cursor > 0);
      }else{
        delete spreadWrap.dataset.canPrev;
      }
    }

    function renderCurrent(){
      if(isMobile()){
        const curPage = ORDER[cursor];
        const nextPage = ORDER[cursor+1] ?? null;
        const isMedia = PAGES[curPage]?.layout === "media";

        cLeft.innerHTML = "";
        uLeft.innerHTML = "";

        if(isMedia){
          cRight.innerHTML = "";
          uRight.innerHTML = "";
          mediaOverlay.innerHTML = pageHTML(curPage);
        }else{
          setPage(cRight, curPage, { showBackMark: cursor>0, showNextMark: cursor < TOTAL-1 });
          setPage(uRight, nextPage, { showBackMark: true, showNextMark: true });
          mediaOverlay.innerHTML = "";
        }

        spreadWrap.classList.toggle("mediaSpread", isMedia);
        updateMobileCues();
      }else{
        const cur = SPREADS[cursor];
        const under = SPREADS[cursor+1] ?? null;

        const leftIdx = cur[0];
        const rightIdx = cur[1];
        const leftPage = PAGES[leftIdx];
        const rightPage = PAGES[rightIdx];
        const mediaIdx = (leftPage?.layout === "media")
          ? leftIdx
          : (rightPage?.layout === "media" ? rightIdx : null);

        if(mediaIdx){
          cLeft.innerHTML = "";
          cLeft.classList.remove("mediaMode");
          cRight.innerHTML = "";
          mediaOverlay.innerHTML = pageHTML(mediaIdx);
          uLeft.innerHTML = "";
          uRight.innerHTML = "";
          spreadWrap.classList.add("mediaSpread");
        }else{
          setPage(cLeft,  leftIdx, { showBackMark: cursor>0, showNextMark:false });
          setPage(cRight, rightIdx, { showBackMark:false, showNextMark:true });

          if(under){
            setPage(uLeft,  under[0], { showBackMark:true, showNextMark:false });
            setPage(uRight, under[1], { showBackMark:false, showNextMark:true });
          }else{
            uLeft.innerHTML = "";
            uRight.innerHTML = "";
          }
          mediaOverlay.innerHTML = "";
          spreadWrap.classList.remove("mediaSpread");
        }
      }
      setupNewYearMedia();
    }

    function setupNewYearMedia(){
      const allWraps = document.querySelectorAll('[data-media-page="newyear"]');
      const allVideos = document.querySelectorAll('[data-media-page="newyear"] video');
      allVideos.forEach((video)=>{
        video.pause();
        video.currentTime = 0;
      });
      allWraps.forEach((wrap)=>{
        wrap.classList.remove("show-white","show-image","show-text","white-out","image-shift");
        const img = wrap.querySelector("img");
        if(img){
          img.style.opacity = "";
        }
      });

      const currentWraps = mediaOverlay.querySelectorAll('[data-media-page="newyear"]');
      currentWraps.forEach((wrap)=>{
        const video = wrap.querySelector("video");
        const img = wrap.querySelector("img");
        if(!video || !img) return;

        video.style.display = "block";
        const onEnd = ()=>{
          wrap.classList.add("show-white");
          setTimeout(()=>{
            video.style.display = "none";
            wrap.classList.remove("show-white");
            wrap.classList.add("white-out");
            wrap.classList.add("show-image","show-text");
            requestAnimationFrame(()=>{
              wrap.classList.add("image-shift");
            });
          }, 1000);
        };
        video.addEventListener("ended", onEnd, { once: true });

        const play = video.play();
        if(play && typeof play.catch === "function"){
          play.catch(()=>{});
        }
      });
    }

    function showFrontCover(){
      mode = "frontCover";
      bookRig.classList.remove("opened","opening");
    }

    function openBook(){
      if (flipping || mode === "open") return;

      flipping = true;
      cursor = 0;

      renderCurrent();

      bookRig.classList.add("opening");
      bookRig.classList.add("opened");

      setTimeout(() => {
        mode = "open";
        bookRig.classList.remove("opening");
        flipping = false;
      }, 320);
    }

    function closeToFrontCover(){
      if (flipping) return;
      flipping = true;

      bookRig.classList.remove("opened");
      setTimeout(() => {
        showFrontCover();
        flipping = false;
      }, 160);
    }

    function startNextFlip(frontHTML, backHTML, onMidSwap){
      nextFront.innerHTML = frontHTML;
      nextBack.innerHTML  = backHTML;

      shadowNext.classList.add("on");
      flipNext.classList.add("active");
      flipNext.style.transform = "rotateY(0deg)";

      flipNext.offsetHeight;
      flipNext.style.transform = "rotateY(-180deg)";

      const mid = setTimeout(onMidSwap, MID_SWAP);

      const finish = () => {
        clearTimeout(mid);
        shadowNext.classList.remove("on");
        flipNext.classList.remove("active");
        flipNext.style.transform = "rotateY(0deg)";
        flipping = false;
      };

      let safety = setTimeout(finish, FLIP_DUR + 120);
      const onEnd = (e)=>{
        if(e.propertyName!=="transform") return;
        clearTimeout(safety);
        flipNext.removeEventListener("transitionend", onEnd);
        finish();
      };
      flipNext.addEventListener("transitionend", onEnd);
    }

    function startPrevFlip(frontHTML, backHTML, onMidSwap){
      prevFront.innerHTML = frontHTML;
      prevBack.innerHTML  = backHTML;

      shadowPrev.classList.add("on");
      flipPrev.classList.add("active");
      flipPrev.style.transform = "rotateY(0deg)";

      flipPrev.offsetHeight;
      flipPrev.style.transform = "rotateY(180deg)";

      const mid = setTimeout(onMidSwap, MID_SWAP);

      const finish = () => {
        clearTimeout(mid);
        shadowPrev.classList.remove("on");
        flipPrev.classList.remove("active");
        flipPrev.style.transform = "rotateY(0deg)";
        flipping = false;
      };

      let safety = setTimeout(finish, FLIP_DUR + 120);
      const onEnd = (e)=>{
        if(e.propertyName!=="transform") return;
        clearTimeout(safety);
        flipPrev.removeEventListener("transitionend", onEnd);
        finish();
      };
      flipPrev.addEventListener("transitionend", onEnd);
    }

    function next(){
      if (mode !== "open" || flipping) return;

      if(isMobile()){
        if (cursor >= TOTAL - 1){
          closeToFrontCover();
          return;
        }
        flipping = true;

        const curPage = ORDER[cursor];
        const nxtPage = ORDER[cursor+1];

        startNextFlip(
          pageHTMLForFlip(curPage, { showBackMark: cursor>0, showNextMark:true }),
          pageHTMLForFlip(nxtPage, { showBackMark:true, showNextMark: (cursor+1) < TOTAL-1 }),
          () => { cursor++; renderCurrent(); }
        );
        return;
      }

      if (cursor >= SPREADS.length - 1){
        closeToFrontCover();
        return;
      }
      flipping = true;

      const cur = SPREADS[cursor];
      const nxt = SPREADS[cursor+1];

      startNextFlip(
        pageHTMLForFlip(cur[1], { showBackMark:false, showNextMark:true }),
        pageHTMLForFlip(nxt[0], { showBackMark:true, showNextMark:false }),
        () => { cursor++; renderCurrent(); }
      );
    }

    function prev(){
      if (mode !== "open" || flipping) return;

      if(isMobile()){
        if (cursor === 0){
          closeToFrontCover();
          return;
        }
        flipping = true;

        const curPage = ORDER[cursor];
        const prvPage = ORDER[cursor-1];

        startPrevFlip(
          pageHTMLForFlip(curPage, { showBackMark:true, showNextMark: cursor < TOTAL-1 }),
          pageHTMLForFlip(prvPage, { showBackMark: (cursor-1)>0, showNextMark:true }),
          () => { cursor--; renderCurrent(); }
        );
        return;
      }

      if (cursor === 0){
        closeToFrontCover();
        return;
      }
      flipping = true;

      const cur = SPREADS[cursor];
      const prv = SPREADS[cursor-1];

      startPrevFlip(
        pageHTMLForFlip(cur[0], { showBackMark:true, showNextMark:false }),
        pageHTMLForFlip(prv[1], { showBackMark:false, showNextMark:true }),
        () => { cursor--; renderCurrent(); }
      );
    }

    function syncCursorOnResize(){
      FLIP_DUR = getMsVar("--flipDur", 600);
      MID_SWAP = Math.floor(FLIP_DUR * 0.35);

      if(mode !== "open") return;

      if(isMobile()){
        const leftPage = SPREADS[cursor]?.[0] ?? ORDER[0];
        cursor = Math.max(0, ORDER.indexOf(leftPage));
      }else{
        const pageIdx = Math.max(0, Math.min(ORDER.length-1, cursor));
        cursor = Math.floor(pageIdx / 2);
      }
      renderCurrent();
    }

    openCorner.addEventListener("click", openBook);

    hotRight.addEventListener("click", ()=>{
      if (mode === "frontCover") openBook();
      else next();
    });

    hotLeft.addEventListener("click", ()=>{
      if (mode === "open") prev();
    });

    mql.addEventListener?.("change", syncCursorOnResize);

    showFrontCover();
  </script>
</body>
</html>
